(this.define||function(e){"use strict";var r="CssParserJs",t=e("undefined"==typeof require?function(){}:require);"undefined"!=typeof module&&module.exports?module.exports=t:this[r]=t}).call(this,function(){"use strict";var e,r,t,n,a,o;return e={Comment:0,CloseBrace:1,OpenBrace:2,SemiColon:3,SelectorOrStyleProperty:4,StylePropertyColon:5,Value:6,Whitespace:7,GetNameFor:function(r){var t;for(t in e)if(e.hasOwnProperty(t)&&e[t]===r)return t;throw new Error("Invalid CharacterCategorisationOptions: "+r)}},r=function(){var r,t,n,a,o,i,c,s,u,C;return r=function(e,r){return{CharacterCategorisation:e,NextProcessor:r}},t=function(e,t){return{Process:function(){return r(e,t)}}},n=function(n){var a={Process:function(o){return o.DoesCurrentContentMatch("\r\n")?r(e.Comment,t(e.Comment,n)):"\r"===o.CurrentCharacter||"\n"===o.CurrentCharacter?r(e.Comment,n):r(e.Comment,a)}};return a},a=function(n){var a={Process:function(o){return o.DoesCurrentContentMatch("*/")?r(e.Comment,t(e.Comment,n)):r(e.Comment,a)}};return a},o=function(t){var n={Process:function(a){return"{"===a.CurrentCharacter?r(e.OpenBrace,t):a.IsWhitespace?r(e.Whitespace,n):r(e.SelectorOrStyleProperty,n)}};return n},i=function(e,n,a){var o={Process:function(i){return"\\"===i.CurrentCharacter?r(n,t(n,o)):i.CurrentCharacter===e?r(n,a):r(n,o)}};return o},c=["lang","link","after","focus","hover","active","before","visited","first-line","first-child","first-letter"],s=function(e){for(;e.IsWhitespace;)e=e.GetNext();return c.some(function(r){return e.DoesCurrentContentMatch(r)})},u=function(r,t,n){var a={EndOfBehaviourOverrideCharacter:t,CharacterCategorisation:e.SelectorOrStyleProperty,CharacterProcessorToReturnTo:n};return C(!1,r,a)},C=function(t,c,h){function l(){return t?C(!1,c,null):f}function g(){return t?f:C(!0,c,null)}var f;return f={Process:function(C){var p,m;if(h&&C.CurrentCharacter===h.EndOfBehaviourOverrideCharacter)return r(h.CharacterCategorisation,h.CharacterProcessorToReturnTo);if("{"===C.CurrentCharacter)return h?r(h.CharacterCategorisation,f):r(e.OpenBrace,l());if("}"===C.CurrentCharacter)return h?r(h.CharacterCategorisation,f):r(e.CloseBrace,l());if(";"===C.CurrentCharacter)return h?r(h.CharacterCategorisation,f):r(e.SemiColon,l());if(":"===C.CurrentCharacter)return h?r(h.CharacterCategorisation,f):!t&&s(C.GetNext())?r(e.SelectorOrStyleProperty,l()):r(e.StylePropertyColon,g());if(C.IsWhitespace)return h?r(h.CharacterCategorisation,f):r(e.Whitespace,f);if("/"===C.CurrentCharacter){if(p=C.GetNext().CurrentCharacter,c&&"/"===p)return r(e.Comment,n(f));if("*"===p)return r(e.Comment,a(f))}return!t&&C.DoesCurrentContentMatch("@media")?r(e.SelectorOrStyleProperty,o(f)):'"'===C.CurrentCharacter||"'"===C.CurrentCharacter?h?r(h.CharacterCategorisation,i(C.CurrentCharacter,h.CharacterCategorisation,f)):r(e.Value,i(C.CurrentCharacter,e.Value,g())):!t&&(m="["===C.CurrentCharacter?"]":"("===C.CurrentCharacter?")":null)?r(e.SelectorOrStyleProperty,u(c,m,f)):r(t?e.Value:e.SelectorOrStyleProperty,f)}}},{GetNewCssProcessor:function(){return C(!1,!1,null)},GetNewLessProcessor:function(){return C(!1,!0,null)}}}(),t=function(e,r){var n=r>=e.length,a={CurrentCharacter:n?null:e.charAt(r),IsWhitespace:n?!1:/\s/.test(e.charAt(r)),DoesCurrentContentMatch:function(t){return t?e.substr(r,t.length)===t:!1}};return a.GetNext=n?function(){return a}:function(){return t(e,r+1)},a},n=function(e,r){for(var n,a=[],o=t(r,0);o.CurrentCharacter;)n=e.Process(o),a.push({Character:o.CurrentCharacter,CharacterCategorisation:n.CharacterCategorisation}),o=o.GetNext(),e=n.NextProcessor;return a},a=function(r){var t=[],n={CharacterCategorisation:null,Characters:[],IndexInSource:null};return r.forEach(function(r,a){var o=r.CharacterCategorisation===e.CloseBrace||r.CharacterCategorisation===e.OpenBrace||r.CharacterCategorisation===e.SemiColon;return r.CharacterCategorisation!==n.CharacterCategorisation||o?(n.Characters.length>0&&t.push({CharacterCategorisation:n.CharacterCategorisation,Value:n.Characters.join(""),IndexInSource:n.IndexInSource}),void(o?(t.push({CharacterCategorisation:r.CharacterCategorisation,Value:r.Character,IndexInSource:a}),n={CharacterCategorisation:null,Characters:[],IndexInSource:null}):n={CharacterCategorisation:r.CharacterCategorisation,Characters:[r.Character],IndexInSource:a})):void n.Characters.push(r.Character)}),n.Characters.length>0&&t.push({CharacterCategorisation:n.CharacterCategorisation,Value:n.Characters.join(""),IndexInSource:n.IndexInSource}),t},o={CharacterCategorisationOptions:e,ParseCss:function(e){return a(n(r.GetNewCssProcessor(),e))},ParseLess:function(e){return a(n(r.GetNewLessProcessor(),e))}},function(){var e,r,t;e=function(){var e,r,t,n,a;return e={EndOfSelector:0,EndOfSelectorSegment:1,SelectorSegment:2},r=function(e,r){return{CharacterCategorisation:e,NextProcessor:r}},t=function(){var t={Process:function(a){return/\s/.test(a)?r(e.EndOfSelectorSegment,t):","===a?r(e.EndOfSelector,t):"["===a?r(e.SelectorSegment,n(t)):r(e.SelectorSegment,t)}};return t},n=function(t){var n={Process:function(o){return'"'===o||"'"===o?r(e.SelectorSegment,a(n,o,!1)):"]"===o?r(e.SelectorSegment,t):r(e.SelectorSegment,n)}};return n},a=function(t,n,o){var i={Process:function(c){return o?r(e.SelectorSegment,a(i,c,!1)):c===n?r(e.SelectorSegment,t):r(e.SelectorSegment,i)}};return i},{Break:function(n){var a,o=[],i=[],c=[],s=t();return n.split("").concat([" "]).forEach(function(t,u){if(a=u===n.length?r(e.EndOfSelector,s):s.Process(t),a.CharacterCategorisation===e.SelectorSegment)c.push(t);else if(a.CharacterCategorisation===e.EndOfSelectorSegment)c.length>0&&(i.push(c.join("")),c=[]);else{if(a.CharacterCategorisation!==e.EndOfSelector)throw new Error("Unsupported CharacterCategorisationOptions: "+a.CharacterCategorisation);c.length>0&&(i.push(c.join("")),c=[]),i.length>0&&(o.push(i),i=[])}s=a.NextProcessor}),o}}}(),r=function(){var r,n,a,i,c,s;return r=function(e){var r=-1;return{GetCurrent:function(){return 0>r||r>=e.length?null:e[r]},MoveNext:function(){return r<e.length&&(r+=1),r<e.length}}},n=function(){var e=null;return{Add:function(r,n,a){e?e.Values.push(n):e={FragmentCategorisation:t.StylePropertyValue,Property:r,Values:[n],SourceLineIndex:a}},GetHasContent:function(){return!!e},ExtractCombinedContentAndClear:function(){if(!e)throw new Error("No content to retrieve");var r=e;return e=null,r}}},a=function(r){var t=e.Break(r),n=[];return t.forEach(function(e){n.push(e.join(" "))}),n},i=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},c=function(e){return-1===e.indexOf("\r")&&-1===e.indexOf("\n")?0:e.match(/\r\n|\r|\n/g).length},s=function(e,r,u){for(var C,h,l,g,f=u,p=[],m=[],d=-1,S=null,P=n();e.MoveNext();)switch(C=e.GetCurrent(),C.CharacterCategorisation){case o.CharacterCategorisationOptions.Comment:p.push({FragmentCategorisation:t.Comment,Value:C.Value,SourceLineIndex:u}),u+=c(C.Value);break;case o.CharacterCategorisationOptions.Whitespace:m.length>0&&m.push(" "),u+=c(C.Value);break;case o.CharacterCategorisationOptions.SelectorOrStyleProperty:0===m.length&&(d=u),m.push(C.Value),P.GetHasContent()&&p.push(P.ExtractCombinedContentAndClear());break;case o.CharacterCategorisationOptions.OpenBrace:if(0===m.length)throw new Error("Encountered OpenBrace with no preceding selector at line "+(u+1));if(P.GetHasContent()&&p.push(P.ExtractCombinedContentAndClear()),h=a(m.join("")),0===h.length)throw new Error("Open brace encountered with no leading selector content at line "+(u+1));l=s(e,r.concat([h]),u),p.push({FragmentCategorisation:"@media"===h[0].toLowerCase().substring(0,6)?t.MediaQuery:t.Selector,ParentSelectors:r,Selectors:h,ChildFragments:l.Fragments,SourceLineIndex:d}),u+=l.NumberOfLinesParsed,m=[];break;case o.CharacterCategorisationOptions.CloseBrace:return P.GetHasContent()&&p.push(P.ExtractCombinedContentAndClear()),m.length>0&&p.push({FragmentCategorisation:t.StylePropertyName,Value:m.join(""),SourceLineIndex:d}),{Fragments:p,NumberOfLinesParsed:u-f};case o.CharacterCategorisationOptions.StylePropertyColon:case o.CharacterCategorisationOptions.SemiColon:if(P.GetHasContent()&&p.push(P.ExtractCombinedContentAndClear()),m.length>0){if(g=m.join(""),"@import"===g.toLowerCase().substring(0,7)){p.push({FragmentCategorisation:t.Import,Value:i(g.substring(7)),SourceLineIndex:u}),m=[];break}S={FragmentCategorisation:t.StylePropertyName,Value:m.join(""),SourceLineIndex:d},p.push(S),m=[]}break;case o.CharacterCategorisationOptions.Value:if(m.length>0){if(g=m.join(""),"@import"===g.toLowerCase().substring(0,7)){m.push(C.Value);break}S={FragmentCategorisation:t.StylePropertyName,Value:m.join(""),SourceLineIndex:d},p.push(S),m=[]}if(!S)throw new Error("Invalid content, orphan style property value encountered at line "+(u+1));P.Add(S,C.Value,d);break;default:throw new Error("Unsupported CharacterCategorisationOptions value: "+C.CharacterCategorisation)}if(m.length>0){if(h=a(m.join("")),0===h.length)throw new Error("Open brace encountered with no leading selector content at line "+(u+1));p.push({FragmentCategorisation:"@media"===h[0].Value.toLowerCase().substring(0,6)?t.MediaQuery:t.Selector,ParentSelectors:r,Selectors:h,ChildFragments:[],SourceLineIndex:u})}return P.GetHasContent()&&p.push(P.ExtractCombinedContentAndClear()),{Fragments:p,NumberOfLinesParsed:u-f}},{ParseIntoStructuredData:function(e){for(var t,n,a=r(e),i=s(a,[],0);a.MoveNext();)if(t=a.GetCurrent(),t.CharacterCategorisation!==o.CharacterCategorisationOptions.Comment&&t.CharacterCategorisation!==o.CharacterCategorisationOptions.Whitespace)throw n=i.Fragments.length>0?i.Fragments[i.Fragments.length-1].SourceLineIndex:0,new Error("Encountered unexpected content (after line "+(n+1)+") - this is often caused by mismatched opening or closing braces");return i.Fragments}}}(),t={Comment:0,Import:1,MediaQuery:2,Selector:3,StylePropertyName:4,StylePropertyValue:5,GetNameFor:function(e){var r;for(r in t)if(t.hasOwnProperty(r)&&t[r]===e)return r;throw new Error("Invalid FragmentCategorisationOptions: "+e)}},o.ExtendedLessParser={ParseIntoStructuredData:function(e){return"string"==typeof e&&(e=o.ParseLess(e)),r.ParseIntoStructuredData(e)},FragmentCategorisationOptions:t}}(),o});