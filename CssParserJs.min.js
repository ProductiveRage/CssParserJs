(this.define||function(e){"use strict";var r="CssParserJs",t=e("undefined"==typeof require?function(){}:require);"undefined"!=typeof module&&module.exports?module.exports=t:this[r]=t}).call(this,function(){"use strict";var e,r,t,n,a,o,i;return e={Comment:0,CloseBrace:1,OpenBrace:2,SemiColon:3,SelectorOrStyleProperty:4,StylePropertyColon:5,Value:6,Whitespace:7,GetNameFor:function(r){var t;for(t in e)if(e.hasOwnProperty(t)&&e[t]===r)return t;throw new Error("Invalid CharacterCategorisationOptions: "+r)}},r=function(e,r){this.message=e,this.indexInSource=r},r.prototype=new Error,r.prototype.constructor=r,r.prototype.name="ParseError",t=function(){var r,t,n,a,o,i,s,c,u,C;return r=function(e,r){return{CharacterCategorisation:e,NextProcessor:r}},t=function(e,t){return{Process:function(){return r(e,t)}}},n=function(n){var a={Process:function(o){return o.DoesCurrentContentMatch("\r\n")?r(e.Comment,t(e.Comment,n)):"\r"===o.CurrentCharacter||"\n"===o.CurrentCharacter?r(e.Comment,n):r(e.Comment,a)}};return a},a=function(n){var a={Process:function(o){return o.DoesCurrentContentMatch("*/")?r(e.Comment,t(e.Comment,n)):r(e.Comment,a)}};return a},o=function(t){var n={Process:function(a){return"{"===a.CurrentCharacter?r(e.OpenBrace,t):a.IsWhitespace?r(e.Whitespace,n):r(e.SelectorOrStyleProperty,n)}};return n},i=function(e,n,a){var o={Process:function(i){return"\\"===i.CurrentCharacter?r(n,t(n,o)):i.CurrentCharacter===e?r(n,a):r(n,o)}};return o},s=["lang","link","after","focus","hover","active","before","visited","first-line","first-child","first-letter"],c=function(e){for(;e.IsWhitespace;)e=e.GetNext();return s.some(function(r){return e.DoesCurrentContentMatch(r)})},u=function(r,t,n){var a={EndOfBehaviourOverrideCharacter:t,CharacterCategorisation:e.SelectorOrStyleProperty,CharacterProcessorToReturnTo:n};return C(!1,r,a)},C=function(t,s,h){function l(){return t?C(!1,s,null):f}function g(){return t?f:C(!0,s,null)}var f;return f={Process:function(C){var p,d;if(h&&C.CurrentCharacter===h.EndOfBehaviourOverrideCharacter)return r(h.CharacterCategorisation,h.CharacterProcessorToReturnTo);if("{"===C.CurrentCharacter)return h?r(h.CharacterCategorisation,f):r(e.OpenBrace,l());if("}"===C.CurrentCharacter)return h?r(h.CharacterCategorisation,f):r(e.CloseBrace,l());if(";"===C.CurrentCharacter)return h?r(h.CharacterCategorisation,f):r(e.SemiColon,l());if(":"===C.CurrentCharacter)return h?r(h.CharacterCategorisation,f):!t&&c(C.GetNext())?r(e.SelectorOrStyleProperty,l()):r(e.StylePropertyColon,g());if(C.IsWhitespace)return h?r(h.CharacterCategorisation,f):r(e.Whitespace,f);if("/"===C.CurrentCharacter){if(p=C.GetNext().CurrentCharacter,s&&"/"===p)return r(e.Comment,n(f));if("*"===p)return r(e.Comment,a(f))}return!t&&C.DoesCurrentContentMatch("@media")?r(e.SelectorOrStyleProperty,o(f)):'"'===C.CurrentCharacter||"'"===C.CurrentCharacter?h?r(h.CharacterCategorisation,i(C.CurrentCharacter,h.CharacterCategorisation,f)):r(e.Value,i(C.CurrentCharacter,e.Value,g())):!t&&(d="["===C.CurrentCharacter?"]":"("===C.CurrentCharacter?")":null)?r(e.SelectorOrStyleProperty,u(s,d,f)):r(t?e.Value:e.SelectorOrStyleProperty,f)}}},{GetNewCssProcessor:function(){return C(!1,!1,null)},GetNewLessProcessor:function(){return C(!1,!0,null)}}}(),n=function(e,r){var t=r>=e.length,a={CurrentCharacter:t?null:e.charAt(r),IsWhitespace:t?!1:/\s/.test(e.charAt(r)),DoesCurrentContentMatch:function(t){return t?e.substr(r,t.length)===t:!1}};return a.GetNext=t?function(){return a}:function(){return n(e,r+1)},a},a=function(e,r){for(var t,a=[],o=n(r,0);o.CurrentCharacter;)t=e.Process(o),a.push({Character:o.CurrentCharacter,CharacterCategorisation:t.CharacterCategorisation}),o=o.GetNext(),e=t.NextProcessor;return a},o=function(r){var t=[],n={CharacterCategorisation:null,Characters:[],IndexInSource:null};return r.forEach(function(r,a){var o=r.CharacterCategorisation===e.CloseBrace||r.CharacterCategorisation===e.OpenBrace||r.CharacterCategorisation===e.SemiColon;return r.CharacterCategorisation!==n.CharacterCategorisation||o?(n.Characters.length>0&&t.push({CharacterCategorisation:n.CharacterCategorisation,Value:n.Characters.join(""),IndexInSource:n.IndexInSource}),void(o?(t.push({CharacterCategorisation:r.CharacterCategorisation,Value:r.Character,IndexInSource:a}),n={CharacterCategorisation:null,Characters:[],IndexInSource:null}):n={CharacterCategorisation:r.CharacterCategorisation,Characters:[r.Character],IndexInSource:a})):void n.Characters.push(r.Character)}),n.Characters.length>0&&t.push({CharacterCategorisation:n.CharacterCategorisation,Value:n.Characters.join(""),IndexInSource:n.IndexInSource}),t},i={CharacterCategorisationOptions:e,ParseError:r,ParseCss:function(e){return o(a(t.GetNewCssProcessor(),e))},ParseLess:function(e){return o(a(t.GetNewLessProcessor(),e))}},function(){var e,t,n;e=function(){var e,t,n,a,o;return e={EndOfSelector:0,EndOfSelectorSegment:1,SelectorSegment:2},t=function(e,r){return{CharacterCategorisation:e,NextProcessor:r}},n=function(){var r={Process:function(n){return/\s/.test(n)?t(e.EndOfSelectorSegment,r):","===n?t(e.EndOfSelector,r):"["===n?t(e.SelectorSegment,a(r)):t(e.SelectorSegment,r)}};return r},a=function(r){var n={Process:function(a){return'"'===a||"'"===a?t(e.SelectorSegment,o(n,a,!1)):"]"===a?t(e.SelectorSegment,r):t(e.SelectorSegment,n)}};return n},o=function(r,n,a){var i={Process:function(s){return a?t(e.SelectorSegment,o(i,s,!1)):s===n?t(e.SelectorSegment,r):t(e.SelectorSegment,i)}};return i},{Break:function(a){var o,i=[],s=[],c=[],u=n();return a.split("").concat([" "]).forEach(function(n,C){if(o=C===a.length?t(e.EndOfSelector,u):u.Process(n),o.CharacterCategorisation===e.SelectorSegment)c.push(n);else if(o.CharacterCategorisation===e.EndOfSelectorSegment)c.length>0&&(s.push(c.join("")),c=[]);else{if(o.CharacterCategorisation!==e.EndOfSelector)throw new r("Unsupported CharacterCategorisationOptions: "+o.CharacterCategorisation,C);c.length>0&&(s.push(c.join("")),c=[]),s.length>0&&(i.push(s),s=[])}u=o.NextProcessor}),i}}}(),t=function(){var t,a,o,s,c,u,C,h;return t=function(e){var r=-1;return{GetCurrent:function(){return 0>r||r>=e.length?null:e[r]},MoveNext:function(){return r<e.length&&(r+=1),r<e.length},TryToPeekAhead:function(t){var n=r+t;return n>=e.length?{Success:!1}:{Success:!0,Value:e[n]}}}},a=function(){var e=null;return{Add:function(r,t,a){e?e.Values.push(t):e={FragmentCategorisation:n.StylePropertyValue,Property:r,Values:[t],SourceLineIndex:a}},GetHasContent:function(){return!!e},ExtractCombinedContentAndClear:function(){if(!e)throw new Error("No content to retrieve");var r=e;return e=null,r}}},o=function(r){var t=e.Break(r),n=[];return t.forEach(function(e){n.push(e.join(" "))}),n},s=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},c=function(e){return-1===e.indexOf("\r")&&-1===e.indexOf("\n")?0:e.match(/\r\n|\r|\n/g).length},u=function(e,r){if(!e)return!1;if(e.FragmentCategorisation!==i.ExtendedLessParser.FragmentCategorisationOptions.StylePropertyName&&e.FragmentCategorisation!==i.ExtendedLessParser.FragmentCategorisationOptions.StylePropertyValue)return!1;for(var t=1;;){var n=r.TryToPeekAhead(t);if(!n.Success)return!1;if(n.Value.CharacterCategorisation===i.CharacterCategorisationOptions.Value)return!0;if(n.Value.CharacterCategorisation!==i.CharacterCategorisationOptions.Comment&&n.Value.CharacterCategorisation!==i.CharacterCategorisationOptions.Whitespace)return!1;t+=1}},C=function(e){return"//"===e.substr(0,2)?"/* "+s(e.substr(2).replace(/\*\//g,"* /"))+" */":e},h=function(e,t,l,g,f){for(var p,d,m,S,P=f,y=[],O=[],x=-1,v=null,I=a();e.MoveNext();)switch(p=e.GetCurrent(),p.CharacterCategorisation){case i.CharacterCategorisationOptions.Comment:t||(u(y.length>0?y[y.length-1]:null,e)?I.Add(v,C(p.Value),x):y.push({FragmentCategorisation:n.Comment,Value:p.Value,SourceLineIndex:f})),f+=c(p.Value);break;case i.CharacterCategorisationOptions.Whitespace:O.length>0&&O.push(" "),f+=c(p.Value);break;case i.CharacterCategorisationOptions.SelectorOrStyleProperty:0===O.length&&(x=f),O.push(p.Value),I.GetHasContent()&&y.push(I.ExtractCombinedContentAndClear());break;case i.CharacterCategorisationOptions.OpenBrace:if(0===O.length)throw new r("Encountered OpenBrace with no preceding selector",p.IndexInSource);if(I.GetHasContent()&&y.push(I.ExtractCombinedContentAndClear()),d=o(O.join("")),0===d.length)throw new r("Open brace encountered with no leading selector content",p.IndexInSource);m=h(e,t,l.concat([d]),g+1,f),y.push({FragmentCategorisation:"@media"===d[0].toLowerCase().substring(0,6)?n.MediaQuery:n.Selector,ParentSelectors:l,Selectors:d,ChildFragments:m.Fragments,SourceLineIndex:x}),f+=m.NumberOfLinesParsed,O=[];break;case i.CharacterCategorisationOptions.CloseBrace:if(0===g)throw new r("Encountered unexpected close brace",p.IndexInSource);return I.GetHasContent()&&y.push(I.ExtractCombinedContentAndClear()),O.length>0&&y.push({FragmentCategorisation:n.StylePropertyName,Value:O.join(""),SourceLineIndex:x}),{Fragments:y,NumberOfLinesParsed:f-P};case i.CharacterCategorisationOptions.StylePropertyColon:case i.CharacterCategorisationOptions.SemiColon:if(I.GetHasContent()&&y.push(I.ExtractCombinedContentAndClear()),O.length>0){if(S=O.join(""),"@import"===S.toLowerCase().substring(0,7)){y.push({FragmentCategorisation:n.Import,Value:s(S.substring(7)),SourceLineIndex:f}),O=[];break}v={FragmentCategorisation:n.StylePropertyName,Value:O.join(""),SourceLineIndex:x},y.push(v),O=[]}break;case i.CharacterCategorisationOptions.Value:if(O.length>0){if(S=O.join(""),"@import"===S.toLowerCase().substring(0,7)){O.push(p.Value);break}v={FragmentCategorisation:n.StylePropertyName,Value:O.join(""),SourceLineIndex:x},y.push(v),O=[]}if(!v)throw new r("Invalid content, orphan style property value encountered",p.IndexInSource);I.Add(v,p.Value,x);break;default:throw new r("Unsupported CharacterCategorisationOptions value: "+p.CharacterCategorisation,p.IndexInSource)}return O.length>0&&(d=o(O.join("")),y.push({FragmentCategorisation:"@media"===d[0].Value.toLowerCase().substring(0,6)?n.MediaQuery:n.Selector,ParentSelectors:l,Selectors:d,ChildFragments:[],SourceLineIndex:f})),I.GetHasContent()&&y.push(I.ExtractCombinedContentAndClear()),{Fragments:y,NumberOfLinesParsed:f-P}},{ParseIntoStructuredData:function(e,n){for(var a,o,s=t(e),c=h(s,n,[],0,0);s.MoveNext();)if(a=s.GetCurrent(),a.CharacterCategorisation!==i.CharacterCategorisationOptions.Comment&&a.CharacterCategorisation!==i.CharacterCategorisationOptions.Whitespace)throw o=c.Fragments.length>0?c.Fragments[c.Fragments.length-1].SourceLineIndex:0,new r("Encountered unexpected content - this is often caused by mismatched opening or closing braces",a.IndexInSource);return c.Fragments}}}(),n={Comment:0,Import:1,MediaQuery:2,Selector:3,StylePropertyName:4,StylePropertyValue:5,GetNameFor:function(e){var r;for(r in n)if(n.hasOwnProperty(r)&&n[r]===e)return r;throw new Error("Invalid FragmentCategorisationOptions: "+e)}},i.ExtendedLessParser={ParseIntoStructuredData:function(e,r){return"string"==typeof e&&(e=i.ParseLess(e)),t.ParseIntoStructuredData(e,r===!0?!0:!1)},FragmentCategorisationOptions:n}}(),i});