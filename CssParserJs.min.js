(function(){"use strict";var r,e,t,n,a,o;r={Comment:0,CloseBrace:1,OpenBrace:2,SemiColon:3,SelectorOrStyleProperty:4,StylePropertyColon:5,Value:6,Whitespace:7,GetNameFor:function(e){var t;for(t in r)if(r.hasOwnProperty(t)&&r[t]===e)return t;throw new Error("Invalid CharacterCategorisationOptions: "+e)}},e=function(){var e,t,n,a,o,i,c,s,C,u;return e=function(r,e){return{CharacterCategorisation:r,NextProcessor:e}},t=function(r,t){return{Process:function(){return e(r,t)}}},n=function(n){var a={Process:function(o){return o.DoesCurrentContentMatch("\r\n")?e(r.Comment,t(r.Comment,n)):"\r"===o.CurrentCharacter||"\n"===o.CurrentCharacter?e(r.Comment,n):e(r.Comment,a)}};return a},a=function(n){var a={Process:function(o){return o.DoesCurrentContentMatch("*/")?e(r.Comment,t(r.Comment,n)):e(r.Comment,a)}};return a},o=function(t){var n={Process:function(a){return"{"===a.CurrentCharacter?e(r.OpenBrace,t):a.IsWhitespace?e(r.Whitespace,n):e(r.SelectorOrStyleProperty,n)}};return n},i=function(r,n,a){var o={Process:function(i){return"\\"===i.CurrentCharacter?e(n,t(n,o)):i.CurrentCharacter===r?e(n,a):e(n,o)}};return o},c=["lang","link","after","focus","hover","active","before","visited","first-line","first-child","first-letter"],s=function(r){for(var e;r.IsWhitespace;)r=r.GetNext();for(e=0;e<c.length;e++)if(r.DoesCurrentContentMatch(c[e]))return!0;return!1},C=function(e,t,n){var a={EndOfBehaviourOverrideCharacter:t,CharacterCategorisation:r.SelectorOrStyleProperty,CharacterProcessorToReturnTo:n};return u(!1,e,a)},u=function(t,c,h){function l(){return t?u(!1,c,null):g}function f(){return t?g:u(!0,c,null)}var g;return g={Process:function(u){var p,m;if(h&&u.CurrentCharacter===h.EndOfBehaviourOverrideCharacter)return e(h.CharacterCategorisation,h.CharacterProcessorToReturnTo);if("{"===u.CurrentCharacter)return h?e(h.CharacterCategorisation,g):e(r.OpenBrace,l());if("}"===u.CurrentCharacter)return h?e(h.CharacterCategorisation,g):e(r.CloseBrace,l());if(";"===u.CurrentCharacter)return h?e(h.CharacterCategorisation,g):e(r.SemiColon,l());if(":"===u.CurrentCharacter)return h?e(h.CharacterCategorisation,g):!t&&s(u.GetNext())?e(r.SelectorOrStyleProperty,l()):e(r.StylePropertyColon,f());if(u.IsWhitespace)return h?e(h.CharacterCategorisation,g):e(r.Whitespace,g);if("/"===u.CurrentCharacter){if(p=u.GetNext().CurrentCharacter,c&&"/"===p)return e(r.Comment,n(g));if("*"===p)return e(r.Comment,a(g))}return!t&&u.DoesCurrentContentMatch("@media")?e(r.SelectorOrStyleProperty,o(g)):'"'===u.CurrentCharacter||"'"===u.CurrentCharacter?h?e(h.CharacterCategorisation,i(u.CurrentCharacter,h.CharacterCategorisation,g)):e(r.Value,i(u.CurrentCharacter,r.Value,f())):!t&&(m="["===u.CurrentCharacter?"]":"("===u.CurrentCharacter?")":null)?e(r.SelectorOrStyleProperty,C(c,m,g)):e(t?r.Value:r.SelectorOrStyleProperty,g)}}},{GetNewCssProcessor:function(){return u(!1,!1,null)},GetNewLessProcessor:function(){return u(!1,!0,null)}}}(),t=function(r,e){var n=e>=r.length,a={CurrentCharacter:n?null:r.charAt(e),IsWhitespace:n?!1:/\s/.test(r.charAt(e)),DoesCurrentContentMatch:function(t){return t?r.substr(e,t.length)===t:!1}};return a.GetNext=n?function(){return a}:function(){return t(r,e+1)},a},n=function(r,e){for(var n,a=[],o=t(e,0);o.CurrentCharacter;)n=r.Process(o),a.push({Character:o.CurrentCharacter,CharacterCategorisation:n.CharacterCategorisation}),o=o.GetNext(),r=n.NextProcessor;return a},a=function(e){var t,n,a,o=[],i={CharacterCategorisation:null,Characters:[],IndexInSource:null};for(t=0;t<e.length;t++)n=e[t],a=n.CharacterCategorisation===r.CloseBrace||n.CharacterCategorisation===r.OpenBrace||n.CharacterCategorisation===r.SemiColon,n.CharacterCategorisation!==i.CharacterCategorisation||a?(i.Characters.length>0&&o.push({CharacterCategorisation:i.CharacterCategorisation,Value:i.Characters.join(""),IndexInSource:i.IndexInSource}),a?(o.push({CharacterCategorisation:n.CharacterCategorisation,Value:n.Character,IndexInSource:t}),i={CharacterCategorisation:null,Characters:[],IndexInSource:null}):i={CharacterCategorisation:n.CharacterCategorisation,Characters:[n.Character],IndexInSource:t}):i.Characters.push(n.Character);return i.Characters.length>0&&o.push({CharacterCategorisation:i.CharacterCategorisation,Value:i.Characters.join(""),IndexInSource:i.IndexInSource}),o},this.CssParserJs=o={CharacterCategorisationOptions:r,ParseCss:function(r){return a(n(e.GetNewCssProcessor(),r))},ParseLess:function(r){return a(n(e.GetNewLessProcessor(),r))}}}).call(this),function(){"use strict";var r,e,t,n=this.CssParserJs;if(!n)throw new Error("CssParserJs required but not present");r=function(){var r,e,t,n,a;return r={EndOfSelector:0,EndOfSelectorSegment:1,SelectorSegment:2},e=function(r,e){return{CharacterCategorisation:r,NextProcessor:e}},t=function(){var t={Process:function(a){return/\s/.test(a)?e(r.EndOfSelectorSegment,t):","===a?e(r.EndOfSelector,t):"["===a?e(r.SelectorSegment,n(t)):e(r.SelectorSegment,t)}};return t},n=function(t){var n={Process:function(o){return'"'===o||"'"===o?e(r.SelectorSegment,a(n,o,!1)):"]"===o?e(r.SelectorSegment,t):e(r.SelectorSegment,n)}};return n},a=function(t,n,o){var i={Process:function(c){return o?e(r.SelectorSegment,a(i,c,!1)):c===n?e(r.SelectorSegment,t):e(r.SelectorSegment,i)}};return i},{Break:function(n){var a,o,i,c=[],s=[],C=[],u=t();for(a=0;a<=n.length;a++){if(a===n.length?(o=null,i=e(r.EndOfSelector,u)):(o=n.charAt(a),i=u.Process(o)),i.CharacterCategorisation===r.SelectorSegment)C.push(o);else if(i.CharacterCategorisation===r.EndOfSelectorSegment)C.length>0&&(s.push(C.join("")),C=[]);else{if(i.CharacterCategorisation!==r.EndOfSelector)throw new Error("Unsupported CharacterCategorisationOptions: "+i.CharacterCategorisation);C.length>0&&(s.push(C.join("")),C=[]),s.length>0&&(c.push(s),s=[])}u=i.NextProcessor}return c}}}(),e=function(){var e,a,o,i,c,s;return e=function(r){var e=-1;return{GetCurrent:function(){return 0>e||e>=r.length?null:r[e]},MoveNext:function(){return e<r.length&&e++,e<r.length}}},a=function(){var r=null;return{Add:function(e,n,a){r?r.Values.push(n):r={FragmentCategorisation:t.StylePropertyValue,Property:e,Values:[n],SourceLineIndex:a}},GetHasContent:function(){return!!r},ExtractCombinedContentAndClear:function(){if(!r)throw new Error("No content to retrieve");var e=r;return r=null,e}}},o=function(e){var t,n=r.Break(e),a=[];for(t=0;t<n.length;t++)a.push(n[t].join(" "));return a},i=function(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")},c=function(r){return-1===r.indexOf("\r")&&-1===r.indexOf("\n")?0:r.match(/\r\n|\r|\n/g).length},s=function(r,e,C){for(var u,h,l,f,g=C,p=[],m=[],S=-1,P=null,d=a();r.MoveNext();)switch(u=r.GetCurrent(),u.CharacterCategorisation){case n.CharacterCategorisationOptions.Comment:p.push({FragmentCategorisation:t.Comment,Value:u.Value,SourceLineIndex:C}),C+=c(u.Value);break;case n.CharacterCategorisationOptions.Whitespace:m.length>0&&m.push(" "),C+=c(u.Value);break;case n.CharacterCategorisationOptions.SelectorOrStyleProperty:0===m.length&&(S=C),m.push(u.Value),d.GetHasContent()&&p.push(d.ExtractCombinedContentAndClear());break;case n.CharacterCategorisationOptions.OpenBrace:if(0===m.length)throw new Error("Encountered OpenBrace with no preceding selector at line "+(C+1));if(d.GetHasContent()&&p.push(d.ExtractCombinedContentAndClear()),h=o(m.join("")),0===h.length)throw new Error("Open brace encountered with no leading selector content at line "+(C+1));l=s(r,e.concat([h]),C),p.push({FragmentCategorisation:"@media"===h[0].toLowerCase().substring(0,6)?t.MediaQuery:t.Selector,ParentSelectors:e,Selectors:h,ChildFragments:l.Fragments,SourceLineIndex:S}),C+=l.NumberOfLinesParsed,m=[];break;case n.CharacterCategorisationOptions.CloseBrace:return d.GetHasContent()&&p.push(d.ExtractCombinedContentAndClear()),m.length>0&&p.push({FragmentCategorisation:t.StylePropertyName,Value:m.join(""),SourceLineIndex:S}),{Fragments:p,NumberOfLinesParsed:C-g};case n.CharacterCategorisationOptions.StylePropertyColon:case n.CharacterCategorisationOptions.SemiColon:if(d.GetHasContent()&&p.push(d.ExtractCombinedContentAndClear()),m.length>0){if(f=m.join(""),"@import"===f.toLowerCase().substring(0,7)){p.push({FragmentCategorisation:t.Import,Value:i(f.substring(7)),SourceLineIndex:C}),m=[];break}P={FragmentCategorisation:t.StylePropertyName,Value:m.join(""),SourceLineIndex:S},p.push(P),m=[]}break;case n.CharacterCategorisationOptions.Value:if(m.length>0){if(f=m.join(""),"@import"===f.toLowerCase().substring(0,7)){m.push(u.Value);break}P={FragmentCategorisation:t.StylePropertyName,Value:m.join(""),SourceLineIndex:S},p.push(P),m=[]}if(!P)throw new Error("Invalid content, orphan style property value encountered at line "+(C+1));d.Add(P,u.Value,S);break;default:throw new Error("Unsupported CharacterCategorisationOptions value: "+u.CharacterCategorisation)}if(m.length>0){if(h=o(m.join("")),0===h.length)throw new Error("Open brace encountered with no leading selector content at line "+(C+1));p.push({FragmentCategorisation:"@media"===h[0].Value.toLowerCase().substring(0,6)?t.MediaQuery:t.Selector,ParentSelectors:e,Selectors:h,ChildFragments:[],SourceLineIndex:C})}return d.GetHasContent()&&p.push(d.ExtractCombinedContentAndClear()),{Fragments:p,NumberOfLinesParsed:C-g}},{ParseIntoStructuredData:function(r){for(var t,a,o=e(r),i=s(o,[],0);o.MoveNext();)if(t=o.GetCurrent(),t.CharacterCategorisation!==n.CharacterCategorisationOptions.Comment&&t.CharacterCategorisation!==n.CharacterCategorisationOptions.Whitespace)throw a=i.Fragments.length>0?i.Fragments[i.Fragments.length-1].SouceLineIndex:0,new Error("Encountered unparsable data, this indicates content (after line "+(a+1)+")");return i.Fragments}}}(),t={Comment:0,Import:1,MediaQuery:2,Selector:3,StylePropertyName:4,StylePropertyValue:5,GetNameFor:function(r){var e;for(e in t)if(t.hasOwnProperty(e)&&t[e]===r)return e;throw new Error("Invalid FragmentCategorisationOptions: "+r)}},n.ExtendedLessParser={ParseIntoStructuredData:e.ParseIntoStructuredData,FragmentCategorisationOptions:t}}.call(this);