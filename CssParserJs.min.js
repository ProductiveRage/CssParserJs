(function(){"use strict";var r,e,t,a,n,o;r={Comment:0,CloseBrace:1,OpenBrace:2,SemiColon:3,SelectorOrStyleProperty:4,StylePropertyColon:5,Value:6,Whitespace:7,GetNameFor:function(e){var t;for(t in r)if(r.hasOwnProperty(t)&&r[t]===e)return t;throw new Error("Invalid CharacterCategorisationOptions: "+e)}},e=function(){var e,t,a,n,o,c,i,C,s,u;return e=function(r,e){return{CharacterCategorisation:r,NextProcessor:e}},t=function(r,t){return{Process:function(){return e(r,t)}}},a=function(a){var n={Process:function(o){return o.DoesCurrentContentMatch("\r\n")?e(r.Comment,t(r.Comment,a)):"\r"===o.CurrentCharacter||"\n"===o.CurrentCharacter?e(r.Comment,a):e(r.Comment,n)}};return n},n=function(a){var n={Process:function(o){return o.DoesCurrentContentMatch("*/")?e(r.Comment,t(r.Comment,a)):e(r.Comment,n)}};return n},o=function(t){var a={Process:function(n){return"{"===n.CurrentCharacter?e(r.OpenBrace,t):n.IsWhitespace?e(r.Whitespace,a):e(r.SelectorOrStyleProperty,a)}};return a},c=function(r,a,n){var o={Process:function(c){return"\\"===c.CurrentCharacter?e(a,t(a,o)):c.CurrentCharacter===r?e(a,n):e(a,o)}};return o},i=["lang","link","after","focus","hover","active","before","visited","first-line","first-child","first-letter"],C=function(r){for(var e;r.IsWhitespace;)r=r.GetNext();for(e=0;e<i.length;e++)if(r.DoesCurrentContentMatch(i[e]))return!0;return!1},s=function(e,t,a){var n={EndOfBehaviourOverrideCharacter:t,CharacterCategorisation:r.SelectorOrStyleProperty,CharacterProcessorToReturnTo:a};return u(!1,e,n)},u=function(t,i,h){function l(){return t?u(!1,i,null):g}function f(){return t?g:u(!0,i,null)}var g;return g={Process:function(u){var p,m;if(h&&u.CurrentCharacter===h.EndOfBehaviourOverrideCharacter)return e(h.CharacterCategorisation,h.CharacterProcessorToReturnTo);if("{"===u.CurrentCharacter)return h?e(h.CharacterCategorisation,g):e(r.OpenBrace,l());if("}"===u.CurrentCharacter)return h?e(h.CharacterCategorisation,g):e(r.CloseBrace,l());if(";"===u.CurrentCharacter)return h?e(h.CharacterCategorisation,g):e(r.SemiColon,l());if(":"===u.CurrentCharacter)return h?e(h.CharacterCategorisation,g):!t&&C(u.GetNext())?e(r.SelectorOrStyleProperty,l()):e(r.StylePropertyColon,f());if(u.IsWhitespace)return h?e(h.CharacterCategorisation,g):e(r.Whitespace,g);if("/"===u.CurrentCharacter){if(p=u.GetNext().CurrentCharacter,i&&"/"===p)return e(r.Comment,a(g));if("*"===p)return e(r.Comment,n(g))}return!t&&u.DoesCurrentContentMatch("@media")?e(r.SelectorOrStyleProperty,o(g)):'"'===u.CurrentCharacter||"'"===u.CurrentCharacter?h?e(h.CharacterCategorisation,c(u.CurrentCharacter,h.CharacterCategorisation,g)):e(r.Value,c(u.CurrentCharacter,r.Value,f())):!t&&(m="["===u.CurrentCharacter?"]":"("===u.CurrentCharacter?")":null)?e(r.SelectorOrStyleProperty,s(i,m,g)):e(t?r.Value:r.SelectorOrStyleProperty,g)}}},{GetNewCssProcessor:function(){return u(!1,!1,null)},GetNewLessProcessor:function(){return u(!1,!0,null)}}}(),t=function(r,e){var a=e>=r.length,n={CurrentCharacter:a?null:r.charAt(e),IsWhitespace:a?!1:/\s/.test(r.charAt(e)),DoesCurrentContentMatch:function(t){return t?r.substr(e,t.length)===t:!1}};return n.GetNext=a?function(){return n}:function(){return t(r,e+1)},n},a=function(r,e){for(var a,n=[],o=t(e,0);o.CurrentCharacter;)a=r.Process(o),n.push({Character:o.CurrentCharacter,CharacterCategorisation:a.CharacterCategorisation}),o=o.GetNext(),r=a.NextProcessor;return n},n=function(e){var t,a,n,o=[],c={CharacterCategorisation:null,Characters:[],IndexInSource:null};for(t=0;t<e.length;t++)a=e[t],n=a.CharacterCategorisation===r.CloseBrace||a.CharacterCategorisation===r.OpenBrace||a.CharacterCategorisation===r.SemiColon,a.CharacterCategorisation!==c.CharacterCategorisation||n?(c.Characters.length>0&&o.push({CharacterCategorisation:c.CharacterCategorisation,Value:c.Characters.join(""),IndexInSource:c.IndexInSource}),n?(o.push({CharacterCategorisation:a.CharacterCategorisation,Value:a.Character,IndexInSource:t}),c={CharacterCategorisation:null,Characters:[],IndexInSource:null}):c={CharacterCategorisation:a.CharacterCategorisation,Characters:[a.Character],IndexInSource:t}):c.Characters.push(a.Character);return c.Characters.length>0&&o.push({CharacterCategorisation:c.CharacterCategorisation,Value:c.Characters.join(""),IndexInSource:c.IndexInSource}),o},this.CssParserJs=o={CharacterCategorisationOptions:r,ParseCss:function(r){return n(a(e.GetNewCssProcessor(),r))},ParseLess:function(r){return n(a(e.GetNewLessProcessor(),r))}}}).call(this),function(){"use strict";var r,e,t,a=this.CssParserJs;if(!a)throw new Error("CssParserJs required but not present");r=function(){var r,e,t,a,n;return r={EndOfSelector:0,EndOfSelectorSegment:1,SelectorSegment:2},e=function(r,e){return{CharacterCategorisation:r,NextProcessor:e}},t=function(){var t={Process:function(n){return/\s/.test(n)?e(r.EndOfSelectorSegment,t):","===n?e(r.EndOfSelector,t):"["===n?e(r.SelectorSegment,a(t)):e(r.SelectorSegment,t)}};return t},a=function(t){var a={Process:function(o){return'"'===o||"'"===o?e(r.SelectorSegment,n(a,o,!1)):"]"===o?e(r.SelectorSegment,t):e(r.SelectorSegment,a)}};return a},n=function(t,a,o){var c={Process:function(i){return o?e(r.SelectorSegment,n(c,i,!1)):i===a?e(r.SelectorSegment,t):e(r.SelectorSegment,c)}};return c},{Break:function(a){var n,o,c,i=[],C=[],s=[],u=t();for(n=0;n<=a.length;n++){if(n===a.length?(o=null,c=e(r.EndOfSelector,u)):(o=a.charAt(n),c=u.Process(o)),c.CharacterCategorisation===r.SelectorSegment)s.push(o);else if(c.CharacterCategorisation===r.EndOfSelectorSegment)s.length>0&&(C.push(s.join("")),s=[]);else{if(c.CharacterCategorisation!==r.EndOfSelector)throw new Error("Unsupported CharacterCategorisationOptions: "+c.CharacterCategorisation);s.length>0&&(C.push(s.join("")),s=[]),C.length>0&&(i.push(C),C=[])}u=c.NextProcessor}return i}}}(),e=function(){var e,n,o,c,i,C,s;return e=function(r){var e=-1;return{GetCurrent:function(){return 0>e||e>=r.length?null:r[e]},MoveNext:function(){return e<r.length&&e++,e<r.length}}},n=function(){var r=null;return{Add:function(e,a,n){r?r.Values.push(a):r={FragmentCategorisation:t.StylePropertyValue,Property:e,Values:[a],SourceLineIndex:n}},GetHasContent:function(){return!!r},ExtractCombinedContentAndClear:function(){if(!r)throw new Error("No content to retrieve");var e=r;return r=null,e}}},o=function(e){var t,a=r.Break(e),n=[];for(t=0;t<a.length;t++)n.push(a[t].join(" "));return n},c=function(r){return i(r.replace(/\s+/g," "))},i=function(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")},C=function(r){return-1===r.indexOf("\r")&&-1===r.indexOf("\n")?0:r.match(/\r\n|\r|\n/g).length},s=function(r,e,c){for(var u,h,l,f,g=c,p=[],m=[],S=-1,P=null,v=n();r.MoveNext();)switch(u=r.GetCurrent(),u.CharacterCategorisation){case a.CharacterCategorisationOptions.Comment:p.push({FragmentCategorisation:t.Comment,Value:u.Value,SourceLineIndex:c}),c+=C(u.Value);break;case a.CharacterCategorisationOptions.Whitespace:m.length>0&&m.push(" "),c+=C(u.Value);break;case a.CharacterCategorisationOptions.SelectorOrStyleProperty:0===m.length&&(S=c),m.push(u.Value),v.GetHasContent()&&p.push(v.ExtractCombinedContentAndClear());break;case a.CharacterCategorisationOptions.OpenBrace:if(0===m.length)throw new Error("Encountered OpenBrace with no preceding selector at line "+(c+1));if(v.GetHasContent()&&p.push(v.ExtractCombinedContentAndClear()),h=o(m.join("")),0===h.length)throw new Error("Open brace encountered with no leading selector content at line "+(c+1));l=s(r,e.concat([h]),c),p.push({FragmentCategorisation:"@media"===h[0].toLowerCase().substring(0,6)?t.MediaQuery:t.Selector,ParentSelectors:e,Selectors:h,ChildFragments:l.Fragments,SourceLineIndex:S}),c+=l.NumberOfLinesParsed,m=[];break;case a.CharacterCategorisationOptions.CloseBrace:return v.GetHasContent()&&p.push(v.ExtractCombinedContentAndClear()),m.length>0&&p.push({FragmentCategorisation:t.StylePropertyName,Value:m.join(""),SourceLineIndex:S}),{Fragments:p,NumberOfLinesParsed:c-g};case a.CharacterCategorisationOptions.StylePropertyColon:case a.CharacterCategorisationOptions.SemiColon:if(v.GetHasContent()&&p.push(v.ExtractCombinedContentAndClear()),m.length>0){if(f=m.join(""),"@import"===f.toLowerCase().substring(0,7)){p.push({FragmentCategorisation:t.Import,Value:i(f.substring(7)),SourceLineIndex:c}),m=[];break}P={FragmentCategorisation:t.StylePropertyName,Value:m.join(""),SourceLineIndex:S},p.push(P),m=[]}break;case a.CharacterCategorisationOptions.Value:if(m.length>0){if(f=m.join(""),"@import"===f.toLowerCase().substring(0,7)){m.push(u.Value);break}P={FragmentCategorisation:t.StylePropertyName,Value:m.join(""),SourceLineIndex:S},p.push(P),m=[]}if(!P)throw new Error("Invalid content, orphan style property value encountered at line "+(c+1));v.Add(P,u.Value,S);break;default:throw new Error("Unsupported CharacterCategorisationOptions value: "+u.CharacterCategorisation)}if(m.length>0){if(h=o(m.join("")),0===h.length)throw new Error("Open brace encountered with no leading selector content at line "+(c+1));p.push({FragmentCategorisation:"@media"===h[0].Value.toLowerCase().substring(0,6)?t.MediaQuery:t.Selector,ParentSelectors:e,Selectors:h,ChildFragments:[],SourceLineIndex:c})}return v.GetHasContent()&&p.push(v.ExtractCombinedContentAndClear()),{Fragments:p,NumberOfLinesParsed:c-g}},{ParseIntoStructuredData:function(r){for(var t,n,o=e(r),c=s(o,[],0);o.MoveNext();)if(t=o.GetCurrent(),t.CharacterCategorisation!==a.CharacterCategorisationOptions.Comment&&t.CharacterCategorisation!==a.CharacterCategorisationOptions.Whitespace)throw n=c.Fragments.length>0?c.Fragments[c.Fragments.length-1].SouceLineIndex:0,new Error("Encountered unparsable data, this indicates content (after line "+(n+1)+")");return c.Fragments}}}(),t={Comment:0,Import:1,MediaQuery:2,Selector:3,StylePropertyName:4,StylePropertyValue:5,GetNameFor:function(r){var e;for(e in t)if(t.hasOwnProperty(e)&&t[e]===r)return e;throw new Error("Invalid FragmentCategorisationOptions: "+r)}},a.ExtendedLessParser={ParseIntoStructuredData:e.ParseIntoStructuredData,FragmentCategorisationOptions:t}}.call(this);